import * as records from 'mock/data/testing/records';
import { NtroDetailsClass } from './NtroDetails';
import NtroDetails from './NtroDetails';

export const ntro = {
    rek_pid: 'UQ:ec5ce03',
    rek_title_xsdmf_id: null,
    rek_title: 'NTRO Test',
    rek_description_xsdmf_id: null,
    rek_description: 'This is an abstract',
    rek_display_type_xsdmf_id: null,
    rek_display_type: 313,
    rek_status_xsdmf_id: null,
    rek_status: 2,
    rek_date_xsdmf_id: null,
    rek_date: '2019-01-01T00:00:00Z',
    rek_object_type_xsdmf_id: null,
    rek_object_type: 3,
    rek_depositor_xsdmf_id: null,
    rek_depositor: 47927,
    rek_created_date_xsdmf_id: null,
    rek_created_date: '2019-02-22T04:16:22Z',
    rek_updated_date_xsdmf_id: null,
    rek_updated_date: '2019-02-22T04:16:23Z',
    rek_file_downloads: 0,
    rek_citation: '',
    rek_genre_xsdmf_id: null,
    rek_genre: null,
    rek_genre_type_xsdmf_id: null,
    rek_genre_type: null,
    rek_formatted_title_xsdmf_id: null,
    rek_formatted_title: null,
    rek_formatted_abstract_xsdmf_id: null,
    rek_formatted_abstract: '<p>This is an abstract</p>',
    rek_depositor_affiliation_xsdmf_id: null,
    rek_depositor_affiliation: null,
    rek_thomson_citation_count: null,
    rek_thomson_citation_count_xsdmf_id: null,
    rek_subtype_xsdmf_id: null,
    rek_subtype: 'Creative Work - Other',
    rek_scopus_citation_count: null,
    rek_herdc_notes_xsdmf_id: null,
    rek_herdc_notes: null,
    rek_scopus_doc_type_xsdmf_id: null,
    rek_scopus_doc_type: null,
    rek_wok_doc_type_xsdmf_id: null,
    rek_wok_doc_type: null,
    rek_pubmed_doc_type_xsdmf_id: null,
    rek_pubmed_doc_type: null,
    rek_security_inherited: null,
    rek_altmetric_score: null,
    rek_altmetric_score_xsdmf_id: null,
    rek_altmetric_id: null,
    rek_altmetric_id_xsdmf_id: null,
    rek_copyright_xsdmf_id: null,
    rek_copyright: null,
    fez_record_search_key_advisory_statement: null,
    fez_record_search_key_article_number: null,
    fez_record_search_key_assigned_group_id: [],
    fez_record_search_key_assigned_user_id: [],
    fez_record_search_key_audience_size: null,
    fez_record_search_key_author: [
        {
            rek_author_id: 32126451,
            rek_author_pid: 'UQ:ec5ce03',
            rek_author_xsdmf_id: null,
            rek_author: 'Ky Lane',
            rek_author_order: 1,
        },
        {
            rek_author_id: 32126452,
            rek_author_pid: 'UQ:ec5ce03',
            rek_author_xsdmf_id: null,
            rek_author: 'Someone else',
            rek_author_order: 2,
        },
        {
            rek_author_id: 32126453,
            rek_author_pid: 'UQ:ec5ce03',
            rek_author_xsdmf_id: null,
            rek_author: 'Someone else again',
            rek_author_order: 3,
        },
    ],
    fez_record_search_key_author_affiliation_country: [
        {
            rek_author_affiliation_country_xsdmf_id: 0,
            rek_author_affiliation_country: 'aus',
            rek_author_affiliation_country_order: 1,
        },
        {
            rek_author_affiliation_country_xsdmf_id: 0,
            rek_author_affiliation_country: 'bel',
            rek_author_affiliation_country_order: 2,
        },
    ],
    fez_record_search_key_author_affiliation_full_address: [
        {
            rek_author_affiliation_full_address_xsdmf_id: 0,
            rek_author_affiliation_full_address: 'Brisbane',
            rek_author_affiliation_full_address_order: 1,
        },
        {
            rek_author_affiliation_full_address_xsdmf_id: 0,
            rek_author_affiliation_full_address: 'Ghent',
            rek_author_affiliation_full_address_order: 2,
        },
    ],
    fez_record_search_key_author_affiliation_id: [],
    fez_record_search_key_author_id: [
        {
            rek_author_id_id: 32231803,
            rek_author_id_pid: 'UQ:ec5ce03',
            rek_author_id_xsdmf_id: null,
            rek_author_id: 4801528,
            rek_author_id_order: 1,
            rek_author_id_lookup: 'Ky Lane',
        },
        {
            rek_author_id_id: 32231804,
            rek_author_id_pid: 'UQ:ec5ce03',
            rek_author_id_xsdmf_id: null,
            rek_author_id: null,
            rek_author_id_order: 2,
        },
    ],
    fez_record_search_key_contributor: [],
    fez_record_search_key_contributor_id: [],
    fez_record_search_key_corresponding_country: [],
    fez_record_search_key_corresponding_email: [],
    fez_record_search_key_corresponding_name: [],
    fez_record_search_key_corresponding_organisation: [],
    fez_record_search_key_datastream_policy: null,
    fez_record_search_key_date_available: null,
    fez_record_search_key_doi: null,
    fez_record_search_key_edition: null,
    fez_record_search_key_end_date: null,
    fez_record_search_key_end_page: null,
    fez_record_search_key_file_attachment_access_condition: [],
    fez_record_search_key_file_attachment_embargo_date: [],
    fez_record_search_key_file_attachment_name: [],
    fez_record_search_key_grant_acronym: [],
    fez_record_search_key_grant_agency: [
        {
            rek_grant_agency_id: 152571,
            rek_grant_agency_pid: 'UQ:ec5ce03',
            rek_grant_agency_xsdmf_id: 0,
            rek_grant_agency: 'Grant 1',
            rek_grant_agency_order: 1,
        },
    ],
    fez_record_search_key_grant_agency_id: [],
    fez_record_search_key_grant_id: [
        {
            rek_grant_id_id: 98635,
            rek_grant_id_pid: 'UQ:ec5ce03',
            rek_grant_id_xsdmf_id: 0,
            rek_grant_id: '0001',
            rek_grant_id_order: 1,
        },
    ],
    fez_record_search_key_grant_text: [],
    fez_record_search_key_grant_type: [],
    fez_record_search_key_herdc_code: {
        rek_herdc_code_id: 4989075,
        rek_herdc_code_pid: 'UQ:ec5ce03',
        rek_herdc_code_xsdmf_id: null,
        rek_herdc_code: 454028,
        rek_herdc_code_lookup: 'CW1',
    },
    fez_record_search_key_herdc_status: {
        rek_herdc_status_id: 3848014,
        rek_herdc_status_pid: 'UQ:ec5ce03',
        rek_herdc_status_xsdmf_id: null,
        rek_herdc_status: 453220,
        rek_herdc_status_lookup: 'Provisional Code',
    },
    fez_record_search_key_institutional_status: null,
    fez_record_search_key_isbn: [],
    fez_record_search_key_isderivationof: [],
    fez_record_search_key_isi_loc: null,
    fez_record_search_key_ismemberof: [
        {
            rek_ismemberof_id: 12421424,
            rek_ismemberof_pid: 'UQ:ec5ce03',
            rek_ismemberof_xsdmf_id: null,
            rek_ismemberof: 'UQ:218198',
            rek_ismemberof_order: 1,
            rek_ismemberof_lookup: 'Unprocessed Records',
        },
    ],
    fez_record_search_key_ismn: [
        {
            rek_ismn: '979-0-7062-0805-4',
            rek_ismn_order: 1,
        },
    ],
    fez_record_search_key_isrc: [],
    fez_record_search_key_issn: [],
    fez_record_search_key_issue_number: {
        rek_issue_number_id: 4621946,
        rek_issue_number_pid: 'UQ:ec5ce03',
        rek_issue_number_xsdmf_id: null,
        rek_issue_number: 'Issue',
    },
    fez_record_search_key_keywords: [],
    fez_record_search_key_language: [
        {
            rek_language_id: 5585569,
            rek_language_pid: 'UQ:ec5ce03',
            rek_language_xsdmf_id: null,
            rek_language: 'eng',
            rek_language_order: 1,
        },
        {
            rek_language_id: 5585570,
            rek_language_pid: 'UQ:ec5ce03',
            rek_language_xsdmf_id: null,
            rek_language: 'elx',
            rek_language_order: 2,
        },
        {
            rek_language_id: 5585571,
            rek_language_pid: 'UQ:ec5ce03',
            rek_language_xsdmf_id: null,
            rek_language: 'egy',
            rek_language_order: 3,
        },
        {
            rek_language_id: 5585572,
            rek_language_pid: 'UQ:ec5ce03',
            rek_language_xsdmf_id: null,
            rek_language: 'dut',
            rek_language_order: 4,
        },
    ],
    fez_record_search_key_link: [
        {
            rek_link_id: 3241451,
            rek_link_pid: 'UQ:ec5ce03',
            rek_link_xsdmf_id: null,
            rek_link: 'http://www.link.com',
            rek_link_order: 1,
        },
    ],
    fez_record_search_key_link_description: [
        {
            rek_link_description_id: 3241462,
            rek_link_description_pid: 'UQ:ec5ce03',
            rek_link_description_xsdmf_id: null,
            rek_link_description: 'Link to work',
            rek_link_description_order: 1,
        },
    ],
    fez_record_search_key_notes: null,
    fez_record_search_key_oa_status: {
        rek_oa_status_id: 674835,
        rek_oa_status_pid: 'UQ:ec5ce03',
        rek_oa_status_xsdmf_id: null,
        rek_oa_status: 453692,
        rek_oa_status_lookup: 'Not yet assessed',
    },
    fez_record_search_key_original_format: {
        rek_original_format_id: 26711,
        rek_original_format_pid: 'UQ:ec5ce03',
        rek_original_format_xsdmf_id: null,
        rek_original_format: 'Description',
    },
    fez_record_search_key_place_of_publication: {
        rek_place_of_publication_id: 4427466,
        rek_place_of_publication_pid: 'UQ:ec5ce03',
        rek_place_of_publication_xsdmf_id: null,
        rek_place_of_publication: 'Place of Pub',
    },
    fez_record_search_key_possible_author_id: [],
    fez_record_search_key_publisher: {
        rek_publisher_id: 4745591,
        rek_publisher_pid: 'UQ:ec5ce03',
        rek_publisher_xsdmf_id: null,
        rek_publisher: 'Publisher',
    },
    fez_record_search_key_refereed: null,
    fez_record_search_key_refereed_source: null,
    fez_record_search_key_scopus_id: null,
    fez_record_search_key_series: {
        rek_series_id: 219436,
        rek_series_pid: 'UQ:ec5ce03',
        rek_series_xsdmf_id: null,
        rek_series: 'Series',
    },
    fez_record_search_key_start_page: null,
    fez_record_search_key_subject: [],
    fez_record_search_key_total_pages: {
        rek_total_pages_id: 5838076,
        rek_total_pages_pid: 'UQ:ec5ce03',
        rek_total_pages_xsdmf_id: null,
        rek_total_pages: 'Extent',
    },
    fez_record_search_key_translated_title: null,
    fez_record_search_key_volume_number: {
        rek_volume_number_id: 5372315,
        rek_volume_number_pid: 'UQ:ec5ce03',
        rek_volume_number_xsdmf_id: null,
        rek_volume_number: 'Volume',
    },
    fez_record_search_key_wok_doc_types: [],
    fez_datastream_info: [],
    fez_matched_journals: [],
    fez_record_search_key_has_datasets: [],
    fez_record_search_key_has_related_datasets: [],
    fez_record_search_key_has_derivations: [],
    rek_display_type_lookup: 'Creative Work',
    rek_pubmed_doc_type_lookup: null,
    rek_object_type_lookup: 'Record',
    rek_scopus_doc_type_lookup: null,
    rek_status_lookup: 'Published',
    rek_wok_doc_type_lookup: null,
    fez_record_search_key_author_affiliation_name: [
        {
            rek_author_affiliation_name_id: 2252508,
            rek_author_affiliation_name_pid: 'UQ:ec5ce03',
            rek_author_affiliation_name: 'Somewhere else',
            rek_author_affiliation_name_order: 2,
        },
    ],
    fez_record_search_key_author_affiliation_type: [
        {
            rek_author_affiliation_type_id: 157,
            rek_author_affiliation_type_pid: 'UQ:ec5ce03',
            rek_author_affiliation_type: 453985,
            rek_author_affiliation_type_order: 2,
            rek_author_affiliation_type_lookup: 'Government',
        },
    ],
    fez_record_search_key_creator_contribution_statement: [
        {
            rek_creator_contribution_statement_id: 293,
            rek_creator_contribution_statement_pid: 'UQ:ec5ce03',
            rek_creator_contribution_statement: '<p>It was significant.</p>',
            rek_creator_contribution_statement_order: 1,
        },
        {
            rek_creator_contribution_statement_id: 294,
            rek_creator_contribution_statement_pid: 'UQ:ec5ce03',
            rek_creator_contribution_statement: 'Missing.',
            rek_creator_contribution_statement_order: 2,
        },
    ],
    fez_record_search_key_grant_agency_type: [
        {
            rek_grant_agency_type_id: 131,
            rek_grant_agency_type_pid: 'UQ:ec5ce03',
            rek_grant_agency_type: 453985,
            rek_grant_agency_type_order: 1,
            rek_grant_agency_type_lookup: 'Government',
        },
    ],
    fez_record_search_key_quality_indicator: [
        {
            rek_quality_indicator_id: 282,
            rek_quality_indicator_pid: 'UQ:ec5ce03',
            rek_quality_indicator: 453996,
            rek_quality_indicator_order: 1,
            rek_quality_indicator_lookup: 'Disseminated via nationally recognised outlet or entity',
        },
        {
            rek_quality_indicator_id: 283,
            rek_quality_indicator_pid: 'UQ:ec5ce03',
            rek_quality_indicator: 453997,
            rek_quality_indicator_order: 2,
            rek_quality_indicator_lookup: 'Disseminated via internationally recognised outlet or entity',
        },
        {
            rek_quality_indicator_id: 284,
            rek_quality_indicator_pid: 'UQ:ec5ce03',
            rek_quality_indicator: 454033,
            rek_quality_indicator_order: 3,
            rek_quality_indicator_lookup: 'Association with recognised national entities, distinct from co-creation',
        },
    ],
    fez_record_search_key_significance: [
        {
            rek_significance_id: 214,
            rek_significance_pid: 'UQ:ec5ce03',
            rek_significance: 454026,
            rek_significance_order: 1,
            rek_significance_lookup: 'Major',
        },
        {
            rek_significance_id: 215,
            rek_significance_pid: 'UQ:ec5ce03',
            rek_significance: 0,
            rek_significance_order: 2,
        },
    ],
};

function setup(testProps = {}, args = { isShallow: true }) {
    const props = {
        classes: {},
        theme: {},
        publication: testProps.publication || ntro,
        account: testProps.account || { canMasquerade: true },
        ...testProps,
    };
    return getElement(NtroDetailsClass, props, args);
}

describe('NtroDetails ', () => {
    it('renders component as expected', () => {
        const wrapper = setup();
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders null for a non NTRO subtype', () => {
        const wrapper = setup({
            publication: {
                ...ntro,
                rek_subtype: 'this isnt NTRO',
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders minor significance as an admin', () => {
        const wrapper = setup({
            account: { canMasquerade: false },
            publication: {
                ...ntro,
                fez_record_search_key_significance: [
                    {
                        rek_significance_id: 214,
                        rek_significance_pid: 'UQ:ec5ce03',
                        rek_significance: 454027,
                        rek_significance_order: 1,
                        rek_significance_lookup: 'Minor',
                    },
                    {
                        rek_significance_id: 215,
                        rek_significance_pid: 'UQ:ec5ce03',
                        rek_significance: 0,
                        rek_significance_order: 2,
                    },
                    {
                        rek_significance_id: 216,
                        rek_significance_pid: 'UQ:ec5ce03',
                        rek_significance: '',
                        rek_significance_order: 3,
                    },
                ],
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders contribution statement not as an admin', () => {
        const wrapper = setup({
            account: { canMasquerade: false },
            publication: {
                ...ntro,
                fez_record_search_key_creator_contribution_statement: [
                    {
                        rek_creator_contribution_statement_id: 293,
                        rek_creator_contribution_statement_pid: 'UQ:ec5ce03',
                        rek_creator_contribution_statement: 'A statement',
                        rek_creator_contribution_statement_order: 1,
                    },
                    {
                        rek_creator_contribution_statement_id: 294,
                        rek_creator_contribution_statement_pid: 'UQ:ec5ce03',
                        rek_creator_contribution_statement: '     ',
                        rek_creator_contribution_statement_order: 2,
                    },
                    {
                        rek_creator_contribution_statement_id: 294,
                        rek_creator_contribution_statement_pid: 'UQ:ec5ce03',
                        rek_creator_contribution_statement: '',
                        rek_creator_contribution_statement_order: 3,
                    },
                ],
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders contribution statement as an admin with a blank statement', () => {
        const wrapper = setup({
            account: { canMasquerade: true },
            publication: {
                ...ntro,
                fez_record_search_key_creator_contribution_statement: [
                    {
                        rek_creator_contribution_statement_id: 293,
                        rek_creator_contribution_statement_pid: 'UQ:ec5ce03',
                        rek_creator_contribution_statement: 'A statement',
                        rek_creator_contribution_statement_order: 1,
                    },
                    {
                        rek_creator_contribution_statement_id: 294,
                        rek_creator_contribution_statement_pid: 'UQ:ec5ce03',
                        rek_creator_contribution_statement: ' ',
                        rek_creator_contribution_statement_order: 2,
                    },
                ],
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders the abstract according to html or plain', () => {
        const wrapper = setup({
            account: { canMasquerade: true },
            publication: {
                ...ntro,
                rek_formatted_abstract: null,
                rek_description: 'Plain text abstract',
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('does not render the abstract at all', () => {
        const wrapper = setup({
            account: { canMasquerade: true },
            publication: {
                ...ntro,
                rek_formatted_abstract: null,
                rek_description: null,
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders ISMN correctly', () => {
        const wrapper = setup({
            account: { canMasquerade: true },
            publication: {
                ...ntro,
                fez_record_search_key_ismn: [{ rek_ismn: 12345 }, { rek_ismn: 67890 }],
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders ISRC correctly', () => {
        const wrapper = setup({
            account: { canMasquerade: true },
            publication: {
                ...ntro,
                fez_record_search_key_isrc: [{ rek_isrc: 12345 }, { rek_isrc: 67890 }],
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders start/end page correctly due to correct doc/sub types', () => {
        const wrapper = setup({
            publication: {
                ...ntro,
                rek_display_type_lookup: 'Creative Work',
                rek_subtype: 'Creative Work - Other',
                fez_record_search_key_start_page: {
                    rek_start_page: 1,
                },
                fez_record_search_key_end_page: {
                    rek_end_page: 2,
                },
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders start/end page correctly due to incorrect doc/sub types', () => {
        const wrapper = setup({
            publication: {
                ...ntro,
                rek_display_type_lookup: 'Journal Article',
                rek_subtype: 'Creative Work - Textual Work',
                fez_record_search_key_start_page: {
                    rek_start_page: 1,
                },
                fez_record_search_key_end_page: {
                    rek_end_page: 2,
                },
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders audience size correctly', () => {
        const wrapper = setup({
            publication: {
                ...ntro,
                fez_record_search_key_audience_size: {
                    rek_audience_size: 999,
                },
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('renders audience size correctly', () => {
        const wrapper = setup({
            publication: {
                ...ntro,
                fez_record_search_key_audience_size: {
                    rek_audience_size: 453992,
                },
            },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('rendered full mount', () => {
        const wrapper = getElement(
            NtroDetails,
            {
                classes: {},
                theme: {},
                publication: ntro,
                account: { canMasquerade: true },
            },
            { isShallow: false },
        );
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('should not render empty component', () => {
        const wrapper = setup({
            publication: {},
            account: { canMasquerade: false },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('should render component with record', () => {
        const wrapper = setup({
            publication: records.ntro2,
            account: { canMasquerade: false },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('should render default fields for record with missing lookups', () => {
        const wrapper = setup({
            publication: records.ntroMinimal,
            account: { canMasquerade: false },
        });
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('should show admin only fields when admin user', () => {
        const thisProps = {
            publication: records.ntro2,
        };
        const wrapper = setup({ ...thisProps });

        expect(toJson(wrapper)).toMatchSnapshot();
    });
});
